<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performans Y√∂netimi - G√ºndoƒüdu Tekstil</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <style>
    :root {
      --bg-dark: #0c1222;
      --bg-card: #151d30;
      --bg-card-light: #1a2540;
      --border-color: #2a3a5c;
      --accent: #d4a853;
      --accent-light: #f0c970;
      --accent-glow: rgba(212, 168, 83, 0.3);
      --text-primary: #ffffff;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --btn-gradient-start: #2563eb;
      --btn-gradient-end: #1d4ed8;
      --btn-gradient-hover-start: #3b82f6;
      --btn-gradient-hover-end: #2563eb;
      --btn-active-start: #1e40af;
      --btn-active-end: #1e3a8a;
      --perf-high: #22c55e;
      --perf-medium: #f59e0b;
      --perf-low: #ef4444;
      --perf-passive: #64748b;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-dark);
      min-height: 100vh;
      color: var(--text-primary);
    }

    /* Header */
    .header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-color);
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left { display: flex; align-items: center; gap: 15px; }

    .logo-icon {
      width: 50px; height: 50px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem;
    }

    .header-title h1 { font-size: 1.3rem; font-weight: 600; }
    .header-title p { font-size: 0.85rem; color: var(--text-secondary); }

    .header-right { display: flex; align-items: center; gap: 15px; }

    .back-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
    }
    .back-btn:hover { border-color: var(--accent); color: var(--accent); }

    /* Main Content */
    .main-content { 
      padding: 30px 40px; 
      max-width: 1400px; 
      margin: 0 auto; 
    }

    /* Tab Button Row */
    .tab-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }

    /* Premium Pill Buttons */
    .tab-pill {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 14px 28px;
      background: linear-gradient(135deg, var(--btn-gradient-start), var(--btn-gradient-end));
      border: 2px solid transparent;
      border-radius: 9999px;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.35);
      position: relative;
      overflow: hidden;
    }

    .tab-pill::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, var(--btn-gradient-hover-start), var(--btn-gradient-hover-end));
      opacity: 0;
      transition: opacity 0.25s ease;
      border-radius: 9999px;
    }

    .tab-pill:hover {
      transform: scale(1.03);
      box-shadow: 0 6px 25px rgba(37, 99, 235, 0.5);
    }

    .tab-pill:hover::before {
      opacity: 1;
    }

    .tab-pill.active {
      background: linear-gradient(135deg, var(--btn-active-start), var(--btn-active-end));
      border-color: rgba(96, 165, 250, 0.5);
      box-shadow: 
        0 6px 25px rgba(37, 99, 235, 0.5),
        inset 0 0 20px rgba(96, 165, 250, 0.15);
    }

    .tab-pill.active::before {
      opacity: 0;
    }

    .tab-pill .pill-icon,
    .tab-pill .pill-text {
      position: relative;
      z-index: 1;
    }

    .pill-icon {
      font-size: 1.3rem;
      transition: transform 0.25s ease;
    }

    .tab-pill:hover .pill-icon {
      transform: scale(1.15);
    }

    /* Content Panel */
    .content-panel {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      min-height: 400px;
      position: relative;
      overflow: hidden;
    }

    /* Tab Content Sections */
    .tab-section {
      opacity: 0;
      visibility: hidden;
      transform: translateY(15px);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: absolute;
      top: 40px;
      left: 40px;
      right: 40px;
    }

    .tab-section.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
      position: relative;
      top: 0;
      left: 0;
      right: 0;
    }

    /* Section Header */
    .section-header {
      display: flex;
      align-items: center;
      gap: 18px;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .section-icon {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--btn-gradient-start), var(--btn-gradient-end));
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 6px;
    }

    .section-subtitle {
      font-size: 0.95rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* Legend Row */
    .chart-legend-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .legend-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .legend-pill.legend-high { border-color: rgba(34, 197, 94, 0.4); }
    .legend-pill.legend-medium { border-color: rgba(245, 158, 11, 0.4); }
    .legend-pill.legend-low { border-color: rgba(239, 68, 68, 0.4); }
    .legend-pill.legend-passive { border-color: rgba(100, 116, 139, 0.4); }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }

    .dot-high { background: var(--perf-high); }
    .dot-medium { background: var(--perf-medium); }
    .dot-low { background: var(--perf-low); }
    .dot-passive { background: var(--perf-passive); }

    /* Evaluation Comments */
    .evaluations-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .evaluations-container::-webkit-scrollbar {
      width: 6px;
    }

    .evaluations-container::-webkit-scrollbar-track {
      background: var(--bg-dark);
      border-radius: 3px;
    }

    .evaluations-container::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 3px;
    }

    .evaluations-container::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    .evaluation-card {
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 18px;
      transition: all 0.2s ease;
    }

    .evaluation-card:hover {
      border-color: var(--accent);
      transform: translateX(4px);
    }

    .evaluation-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .evaluation-target {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .evaluation-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--bg-dark);
    }

    .evaluation-target-info h4 {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .evaluation-category {
      font-size: 0.75rem;
      padding: 4px 10px;
      background: rgba(212, 168, 83, 0.15);
      color: var(--accent);
      border-radius: 12px;
      font-weight: 500;
    }

    .evaluation-date {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .evaluation-comment {
      font-size: 0.9rem;
      color: var(--text-secondary);
      line-height: 1.6;
      padding: 12px;
      background: var(--bg-card);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
      margin-bottom: 10px;
    }

    .evaluation-author {
      font-size: 0.8rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .evaluation-author span {
      color: var(--text-secondary);
      font-weight: 500;
    }

    .evaluations-loading, .evaluations-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      color: var(--text-muted);
      text-align: center;
    }

    .evaluations-loading .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    .evaluations-stats {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .eval-stat {
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 12px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .eval-stat-icon {
      font-size: 1.3rem;
    }

    .eval-stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .eval-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Sub-tabs for Evaluation section */
    .sub-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 15px;
    }

    .sub-tab-btn {
      padding: 10px 20px;
      background: transparent;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .sub-tab-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }

    .sub-tab-btn.active {
      background: rgba(212, 168, 83, 0.15);
      border-color: var(--accent);
      color: var(--accent);
    }

    .sub-tab-content {
      display: none;
    }

    .sub-tab-content.active {
      display: block;
    }

    /* Reward Rules Section */
    .rewards-section {
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .rules-panel {
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
    }

    .rules-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .rules-header h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-add-rule {
      padding: 8px 16px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--bg-dark);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-add-rule:hover {
      box-shadow: 0 4px 15px var(--accent-glow);
      transform: translateY(-1px);
    }

    .rules-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .rule-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .rule-item:hover {
      border-color: var(--accent);
    }

    .rule-range {
      min-width: 100px;
      padding: 6px 12px;
      background: var(--bg-dark);
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-primary);
      text-align: center;
    }

    .rule-type {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .rule-type.cash { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .rule-type.giftCard { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
    .rule-type.other { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }

    .rule-description {
      flex: 1;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .rule-actions {
      display: flex;
      gap: 8px;
    }

    .btn-rule-action {
      padding: 6px 10px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-rule-action:hover {
      border-color: var(--accent);
    }

    .btn-rule-action.delete:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    /* Employee Rewards Table */
    .rewards-table-container {
      overflow-x: auto;
    }

    .rewards-table {
      width: 100%;
      border-collapse: collapse;
    }

    .rewards-table th {
      padding: 12px 15px;
      text-align: left;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--accent);
      text-transform: uppercase;
      background: rgba(212, 168, 83, 0.1);
      border-bottom: 1px solid var(--border-color);
    }

    .rewards-table td {
      padding: 12px 15px;
      font-size: 0.85rem;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
    }

    .rewards-table tbody tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .efficiency-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .efficiency-badge.high { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .efficiency-badge.medium { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .efficiency-badge.low { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    .efficiency-badge.passive { background: rgba(100, 116, 139, 0.2); color: #94a3b8; }

    .reward-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
    }

    .reward-badge.cash { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
    .reward-badge.giftCard { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
    .reward-badge.other { background: rgba(100, 116, 139, 0.15); color: #94a3b8; }

    /* Rule Form Modal */
    .rule-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .rule-modal.active {
      display: flex;
    }

    .rule-modal-content {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      width: 90%;
      max-width: 450px;
      padding: 25px;
    }

    .rule-modal h3 {
      font-size: 1.1rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .rule-form-group {
      margin-bottom: 15px;
    }

    .rule-form-group label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .rule-form-group input,
    .rule-form-group select {
      width: 100%;
      padding: 10px 12px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9rem;
      color: var(--text-primary);
    }

    .rule-form-group input:focus,
    .rule-form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .rule-form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .rule-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-modal-cancel {
      padding: 10px 18px;
      background: var(--bg-dark);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9rem;
      color: var(--text-primary);
      cursor: pointer;
    }

    .btn-modal-save {
      padding: 10px 18px;
      background: linear-gradient(135deg, var(--accent), var(--accent-light));
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--bg-dark);
      cursor: pointer;
    }

    /* Chart Container */
    .chart-container {
      position: relative;
      width: 100%;
      height: 500px;
      background: var(--bg-card-light);
      border-radius: 16px;
      padding: 20px;
    }

    .chart-wrapper {
      width: 100%;
      height: 100%;
    }

    #performanceChart {
      width: 100% !important;
      height: 100% !important;
    }

    .chart-loading, .chart-empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      font-size: 1rem;
      text-align: center;
    }

    .chart-loading .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid var(--border-color);
      border-top-color: var(--btn-gradient-start);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .chart-empty-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .chart-empty-text {
      max-width: 300px;
      line-height: 1.6;
    }

    /* Placeholder Content for Forms */
    .placeholder-content {
      background: var(--bg-card-light);
      border: 2px dashed var(--border-color);
      border-radius: 16px;
      padding: 50px 30px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .placeholder-content:hover {
      border-color: var(--btn-gradient-start);
      background: rgba(37, 99, 235, 0.05);
    }

    .placeholder-icon {
      font-size: 3.5rem;
      margin-bottom: 20px;
      opacity: 0.6;
    }

    .placeholder-text {
      font-size: 1rem;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
      line-height: 1.7;
    }

    /* Footer */
    .dashboard-footer {
      text-align: center;
      padding: 30px;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    .dashboard-footer a { color: var(--accent); text-decoration: none; }

    /* Responsive */
    @media (max-width: 768px) {
      .header { 
        flex-direction: column; 
        gap: 15px; 
        padding: 20px; 
      }
      
      .main-content { padding: 20px; }
      
      .tab-row {
        flex-direction: column;
        gap: 15px;
      }
      
      .tab-pill {
        width: 100%;
        justify-content: center;
        padding: 16px 24px;
      }
      
      .content-panel { 
        padding: 25px; 
        border-radius: 16px;
      }
      
      .tab-section {
        top: 25px;
        left: 25px;
        right: 25px;
      }
      
      .section-header {
        flex-direction: column;
        text-align: center;
      }
      
      .section-icon {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
      }
      
      .section-title { font-size: 1.3rem; }
      
      .chart-container {
        height: 350px;
        padding: 15px;
      }

      .chart-legend {
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-left">
      <div class="logo-icon">üìä</div>
      <div class="header-title">
        <h1>Performans Y√∂netimi</h1>
        <p>Personel performans analizi ve deƒüerlendirme</p>
      </div>
    </div>
    <div class="header-right">
      <a href="/admin-personnel.html" class="back-btn">‚Üê Personel Y√∂netimine D√∂n</a>
      <a href="/admin-dashboard.html" class="back-btn">üè† Admin Paneli</a>
    </div>
  </header>

  <main class="main-content">
    <!-- Tab Button Row -->
    <div class="tab-row">
      <button class="tab-pill active" data-tab="charts">
        <span class="pill-icon">üìà</span>
        <span class="pill-text">Performans Grafikleri</span>
      </button>
      <button class="tab-pill" data-tab="forms">
        <span class="pill-icon">üìã</span>
        <span class="pill-text">Deƒüerlendirme Formlarƒ±</span>
      </button>
    </div>

    <!-- Content Panel -->
    <div class="content-panel">
      <!-- Charts Section -->
      <div class="tab-section active" id="section-charts">
        <div class="section-header">
          <div class="section-icon">üìà</div>
          <div>
            <h2 class="section-title">Performans Grafikleri</h2>
            <p class="section-subtitle">Personel ortalama verimlilik y√ºzdelerini g√∂rsel olarak analiz edin</p>
          </div>
        </div>
        
        <!-- Legend -->
        <div class="chart-legend-row">
          <div class="legend-pill legend-high">
            <span class="legend-dot dot-high"></span>
            <span>Y√ºksek Performans (80‚Äì100%)</span>
          </div>
          <div class="legend-pill legend-medium">
            <span class="legend-dot dot-medium"></span>
            <span>Orta Performans (60‚Äì80%)</span>
          </div>
          <div class="legend-pill legend-low">
            <span class="legend-dot dot-low"></span>
            <span>D√º≈ü√ºk Performans (0‚Äì60%)</span>
          </div>
          <div class="legend-pill legend-passive">
            <span class="legend-dot dot-passive"></span>
            <span>Pasif Personel (0%)</span>
          </div>
        </div>

        <div class="chart-container" id="chartContainer">
          <div class="chart-loading" id="chartLoading">
            <div class="spinner"></div>
            <span>Veriler y√ºkleniyor...</span>
          </div>
          <div class="chart-empty" id="chartEmpty" style="display: none;">
            <div class="chart-empty-icon">üì≠</div>
            <p class="chart-empty-text">Hen√ºz performans verisi bulunmuyor. Personel vardiya kayƒ±tlarƒ± eklendik√ße burada g√∂r√ºnt√ºlenecektir.</p>
          </div>
          <div class="chart-wrapper" id="chartWrapper" style="display: none;">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Forms Section -->
      <div class="tab-section" id="section-forms">
        <div class="section-header">
          <div class="section-icon">üìã</div>
          <div>
            <h2 class="section-title">Deƒüerlendirme Formlarƒ±</h2>
            <p class="section-subtitle">Personel deƒüerlendirmeleri ve √∂d√ºl y√∂netimi</p>
          </div>
        </div>

        <!-- Sub-tabs -->
        <div class="sub-tabs">
          <button class="sub-tab-btn active" data-subtab="comments">
            üí¨ Personel G√∂r√º≈üleri
          </button>
          <button class="sub-tab-btn" data-subtab="rewards">
            üèÜ √ñd√ºl Y√∂netimi
          </button>
        </div>

        <!-- Comments Sub-tab -->
        <div class="sub-tab-content active" id="subtab-comments">
          <!-- Stats -->
          <div class="evaluations-stats" id="evalStats">
            <div class="eval-stat">
              <span class="eval-stat-icon">üí¨</span>
              <div>
                <div class="eval-stat-value" id="totalComments">--</div>
                <div class="eval-stat-label">Toplam Yorum</div>
              </div>
            </div>
            <div class="eval-stat">
              <span class="eval-stat-icon">üë•</span>
              <div>
                <div class="eval-stat-value" id="totalEvaluated">--</div>
                <div class="eval-stat-label">Deƒüerlendirilen</div>
              </div>
            </div>
            <div class="eval-stat">
              <span class="eval-stat-icon">üìä</span>
              <div>
                <div class="eval-stat-value" id="totalCategories">--</div>
                <div class="eval-stat-label">Kategori</div>
              </div>
            </div>
          </div>

          <!-- Comments Container -->
          <div class="evaluations-container" id="evaluationsContainer">
            <div class="evaluations-loading" id="evalLoading">
              <div class="spinner"></div>
              <span>Deƒüerlendirmeler y√ºkleniyor...</span>
            </div>
          </div>
        </div>

        <!-- Rewards Sub-tab -->
        <div class="sub-tab-content" id="subtab-rewards">
          <div class="rewards-section">
            <!-- Rules Panel -->
            <div class="rules-panel">
              <div class="rules-header">
                <h4>üìú √ñd√ºl Kurallarƒ±</h4>
                <button class="btn-add-rule" onclick="openRuleModal()">
                  ‚ûï Yeni Kural
                </button>
              </div>
              <div class="rules-list" id="rulesList">
                <div class="evaluations-loading">
                  <div class="spinner"></div>
                  <span>Kurallar y√ºkleniyor...</span>
                </div>
              </div>
            </div>

            <!-- Employee Rewards Table -->
            <div class="rules-panel">
              <div class="rules-header">
                <h4>üë• Personel √ñd√ºlleri</h4>
              </div>
              <div class="rewards-table-container">
                <table class="rewards-table">
                  <thead>
                    <tr>
                      <th>Personel</th>
                      <th>Verimlilik</th>
                      <th>√ñd√ºl</th>
                    </tr>
                  </thead>
                  <tbody id="employeeRewardsBody">
                    <tr>
                      <td colspan="3">
                        <div class="evaluations-loading">
                          <div class="spinner"></div>
                          <span>Hesaplanƒ±yor...</span>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Rule Modal -->
      <div class="rule-modal" id="ruleModal">
        <div class="rule-modal-content">
          <h3>üèÜ <span id="ruleModalTitle">Yeni √ñd√ºl Kuralƒ±</span></h3>
          <form id="ruleForm">
            <input type="hidden" id="ruleId">
            <div class="rule-form-row">
              <div class="rule-form-group">
                <label>Min Verimlilik (%)</label>
                <input type="number" id="ruleMin" min="0" max="200" required placeholder="√∂rn: 80">
              </div>
              <div class="rule-form-group">
                <label>Max Verimlilik (%) <small>(bo≈ü = sƒ±nƒ±rsƒ±z)</small></label>
                <input type="number" id="ruleMax" min="0" max="200" placeholder="√∂rn: 100">
              </div>
            </div>
            <div class="rule-form-group">
              <label>√ñd√ºl T√ºr√º</label>
              <select id="ruleType" required>
                <option value="cash">üíµ Nakit Prim</option>
                <option value="giftCard">üéÅ Hediye Kartƒ±</option>
                <option value="other">üì¶ Diƒüer</option>
              </select>
            </div>
            <div class="rule-form-group">
              <label>Tutar (TL) <small>(opsiyonel)</small></label>
              <input type="number" id="ruleAmount" min="0" placeholder="√∂rn: 2500">
            </div>
            <div class="rule-form-group">
              <label>A√ßƒ±klama</label>
              <input type="text" id="ruleDescription" required placeholder="√∂rn: 2500 TL prim">
            </div>
            <div class="rule-modal-actions">
              <button type="button" class="btn-modal-cancel" onclick="closeRuleModal()">ƒ∞ptal</button>
              <button type="submit" class="btn-modal-save">Kaydet</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>

  <footer class="dashboard-footer">
    <p>¬© 2025 G√ºndoƒüdu Tekstil. T√ºm haklarƒ± saklƒ±dƒ±r. | <a href="/admin-dashboard.html">Admin Paneli</a></p>
  </footer>

  <script>
    // Tab state management
    let activeTab = 'charts';
    let performanceChart = null;
    let chartFullNames = [];

    const tabButtons = document.querySelectorAll('.tab-pill');
    const tabSections = document.querySelectorAll('.tab-section');

    function switchTab(tabName) {
      activeTab = tabName;

      tabButtons.forEach(btn => {
        if (btn.dataset.tab === tabName) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      tabSections.forEach(section => {
        if (section.id === `section-${tabName}`) {
          section.classList.add('active');
        } else {
          section.classList.remove('active');
        }
      });
    }

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const tabName = btn.dataset.tab;
        if (tabName !== activeTab) {
          switchTab(tabName);
        }
      });
    });

    // Performance colors based on efficiency level (matches Personnel Management)
    function getPerformanceColor(efficiency) {
      const val = parseFloat(efficiency);
      if (val === 0) return '#64748b';    // Passive - Gray (0%)
      if (val >= 80) return '#22c55e';    // High - Green (80-100%)
      if (val >= 60) return '#f59e0b';    // Medium - Orange (60-80%)
      return '#ef4444';                    // Low - Red (1-60%)
    }

    // Load and render performance bar chart
    async function loadPerformanceChart() {
      console.log('[Chart] Starting to load performance chart...');
      
      const loadingEl = document.getElementById('chartLoading');
      const emptyEl = document.getElementById('chartEmpty');
      const chartWrapper = document.getElementById('chartWrapper');
      const canvas = document.getElementById('performanceChart');
      
      try {
        console.log('[Chart] Fetching ALL employees...');
        const response = await fetch('/api/performance/employee-averages');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('[Chart] Total employees received:', data ? data.length : 0);
        
        // Hide loading
        loadingEl.style.display = 'none';
        
        // Check if data is empty
        if (!data || !Array.isArray(data) || data.length === 0) {
          emptyEl.style.display = 'flex';
          return;
        }
        
        // Show chart
        emptyEl.style.display = 'none';
        chartWrapper.style.display = 'block';
        
        // Prepare data for chart - ALL employees with FULL NAMES
        chartFullNames = data.map(emp => emp.fullName || 'Unknown');
        const labels = chartFullNames; // Use full names, no truncation
        const values = data.map(emp => parseFloat(emp.averageEfficiency) || 0);
        const colors = values.map(val => getPerformanceColor(val));
        
        // Calculate bar sizing based on employee count
        const employeeCount = data.length;
        let categoryPct = 0.7;
        let barPct = 0.85;
        
        if (employeeCount > 15) {
          categoryPct = 0.6;
          barPct = 0.8;
        }
        if (employeeCount > 25) {
          categoryPct = 0.5;
          barPct = 0.75;
        }
        if (employeeCount > 35) {
          categoryPct = 0.45;
          barPct = 0.7;
        }
        
        // Destroy existing chart
        if (performanceChart) {
          performanceChart.destroy();
          performanceChart = null;
        }
        
        // Create bar chart - responsive, fits all bars with full names
        const ctx = canvas.getContext('2d');
        
        performanceChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Ortalama Verimlilik',
              data: values,
              backgroundColor: colors.map(c => c + 'cc'),
              borderColor: colors,
              borderWidth: 1,
              borderRadius: 3,
              borderSkipped: false,
              categoryPercentage: categoryPct,
              barPercentage: barPct
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
              padding: {
                top: 10,
                bottom: 80,
                left: 10,
                right: 10
              }
            },
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                enabled: true,
                backgroundColor: '#1a2540',
                titleColor: '#ffffff',
                bodyColor: '#94a3b8',
                borderColor: '#2a3a5c',
                borderWidth: 1,
                padding: 12,
                cornerRadius: 8,
                titleFont: {
                  family: 'Poppins',
                  size: 13,
                  weight: '600'
                },
                bodyFont: {
                  family: 'Poppins',
                  size: 12
                },
                callbacks: {
                  title: function(context) {
                    return context[0].label;
                  },
                  label: function(context) {
                    const value = context.parsed.y;
                    let level = 'Pasif';
                    if (value >= 80) level = 'Y√ºksek Performans';
                    else if (value >= 60) level = 'Orta Performans';
                    else if (value > 0) level = 'D√º≈ü√ºk Performans';
                    return [`Verimlilik: ${value.toFixed(1)}%`, level];
                  }
                }
              }
            },
            scales: {
              x: {
                grid: {
                  display: false
                },
                ticks: {
                  color: '#94a3b8',
                  font: {
                    family: 'Poppins',
                    size: 10,
                    weight: '500'
                  },
                  maxRotation: 55,
                  minRotation: 45,
                  autoSkip: false
                }
              },
              y: {
                min: 0,
                suggestedMax: 120,
                grid: {
                  color: 'rgba(42, 58, 92, 0.5)',
                  drawBorder: false
                },
                ticks: {
                  color: '#64748b',
                  font: {
                    family: 'Poppins',
                    size: 10
                  },
                  stepSize: 20,
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            },
            animation: {
              duration: 800,
              easing: 'easeOutQuart'
            }
          }
        });
        
        console.log('[Chart] Chart created with', data.length, 'employees - full names displayed');
        
      } catch (error) {
        console.error('[Chart] Error:', error);
        loadingEl.style.display = 'none';
        emptyEl.innerHTML = `
          <div class="chart-empty-icon">‚ö†Ô∏è</div>
          <p class="chart-empty-text">Performans verileri y√ºklenirken hata olu≈ütu.<br><small style="color: #ef4444;">${error.message}</small></p>
        `;
        emptyEl.style.display = 'flex';
      }
    }

    // Load and render evaluation comments
    async function loadEvaluations() {
      console.log('[Evaluations] Loading peer feedback comments...');
      
      const container = document.getElementById('evaluationsContainer');
      const loadingEl = document.getElementById('evalLoading');
      
      try {
        const response = await fetch('/api/personel-degerlendirme');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const evaluations = await response.json();
        console.log('[Evaluations] Received', evaluations.length, 'evaluations');
        
        // Update stats
        const uniqueTargets = new Set(evaluations.map(e => e.hedef_adsoyad));
        const uniqueCategories = new Set(evaluations.map(e => e.kategori));
        
        document.getElementById('totalComments').textContent = evaluations.length;
        document.getElementById('totalEvaluated').textContent = uniqueTargets.size;
        document.getElementById('totalCategories').textContent = uniqueCategories.size;
        
        // Check if empty
        if (!evaluations || evaluations.length === 0) {
          container.innerHTML = `
            <div class="evaluations-empty">
              <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;">üì≠</div>
              <p>Hen√ºz deƒüerlendirme yorumu bulunmuyor.</p>
            </div>
          `;
          return;
        }
        
        // Render comments
        container.innerHTML = evaluations.map(eval => {
          const initials = getInitials(eval.hedef_adsoyad);
          const dateStr = formatDate(eval.olusturma_tarihi);
          const puan = parseInt(eval.puan, 10) || 0;
          
          // Generate star rating display
          const stars = [];
          for (let i = 1; i <= 5; i++) {
            stars.push(i <= puan ? '‚òÖ' : '‚òÜ');
          }
          const starDisplay = stars.join('');
          
          return `
            <div class="evaluation-card">
              <div class="evaluation-header">
                <div class="evaluation-target">
                  <div class="evaluation-avatar">${initials}</div>
                  <div class="evaluation-target-info">
                    <h4>${eval.hedef_adsoyad}</h4>
                    <span class="evaluation-category">${eval.kategori}</span>
                  </div>
                </div>
                <span class="evaluation-date">${dateStr}</span>
              </div>
              <div class="evaluation-rating" style="margin: 8px 0; font-size: 1.2rem; color: #fbbf24;">
                ${starDisplay}
              </div>
              <div class="evaluation-comment">
                "${eval.yorum}"
              </div>
              <div class="evaluation-author">
                ‚úçÔ∏è Yazan: <span>${eval.yazar_adsoyad}</span>
              </div>
            </div>
          `;
        }).join('');
        
        console.log('[Evaluations] Rendered', evaluations.length, 'evaluation cards');
        
      } catch (error) {
        console.error('[Evaluations] Error:', error);
        container.innerHTML = `
          <div class="evaluations-empty">
            <div style="font-size: 3rem; margin-bottom: 15px;">‚ö†Ô∏è</div>
            <p>Deƒüerlendirmeler y√ºklenirken hata olu≈ütu.</p>
            <small style="color: var(--danger);">${error.message}</small>
          </div>
        `;
      }
    }
    
    // Get initials from name
    function getInitials(name) {
      if (!name) return '?';
      const parts = name.split(' ');
      if (parts.length >= 2) {
        return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
      }
      return name.substring(0, 2).toUpperCase();
    }
    
    // Format date
    function formatDate(isoString) {
      if (!isoString) return '-';
      const date = new Date(isoString);
      return date.toLocaleDateString('tr-TR', {
        day: 'numeric',
        month: 'short',
        year: 'numeric'
      });
    }

    // ========== REWARDS MANAGEMENT ==========
    
    let currentRules = [];
    let editingRuleId = null;

    // Sub-tab switching
    document.querySelectorAll('.sub-tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const subtab = btn.dataset.subtab;
        
        // Update button states
        document.querySelectorAll('.sub-tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Update content visibility
        document.querySelectorAll('.sub-tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`subtab-${subtab}`).classList.add('active');
        
        // Load rewards data when switching to rewards tab
        if (subtab === 'rewards') {
          loadRewardRules();
          loadEmployeeRewards();
        }
      });
    });

    // Load reward rules
    async function loadRewardRules() {
      console.log('[Rewards] Loading rules...');
      const container = document.getElementById('rulesList');
      
      try {
        const response = await fetch('/api/rewards/rules');
        const rules = await response.json();
        currentRules = rules;
        
        if (rules.length === 0) {
          container.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">Hen√ºz kural tanƒ±mlanmamƒ±≈ü.</p>';
          return;
        }
        
        container.innerHTML = rules.map(rule => {
          const rangeText = rule.maxPercentage 
            ? `${rule.minPercentage}% - ${rule.maxPercentage}%`
            : `‚â• ${rule.minPercentage}%`;
          
          const typeLabels = { cash: 'üíµ Nakit', giftCard: 'üéÅ Hediye', other: 'üì¶ Diƒüer' };
          
          return `
            <div class="rule-item">
              <div class="rule-range">${rangeText}</div>
              <span class="rule-type ${rule.rewardType}">${typeLabels[rule.rewardType] || rule.rewardType}</span>
              <span class="rule-description">${rule.description}</span>
              <div class="rule-actions">
                <button class="btn-rule-action" onclick="editRule(${rule.id})">‚úèÔ∏è</button>
                <button class="btn-rule-action delete" onclick="deleteRule(${rule.id})">üóëÔ∏è</button>
              </div>
            </div>
          `;
        }).join('');
        
      } catch (error) {
        console.error('[Rewards] Error loading rules:', error);
        container.innerHTML = '<p style="color: var(--danger); text-align: center;">Kurallar y√ºklenemedi.</p>';
      }
    }

    // Load employee rewards
    async function loadEmployeeRewards() {
      console.log('[Rewards] Loading employee rewards...');
      const tbody = document.getElementById('employeeRewardsBody');
      
      try {
        const response = await fetch('/api/rewards/employee-rewards');
        const employees = await response.json();
        
        if (employees.length === 0) {
          tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--text-muted);">Personel bulunamadƒ±.</td></tr>';
          return;
        }
        
        tbody.innerHTML = employees.map(emp => {
          const eff = parseFloat(emp.efficiency);
          let effClass = 'passive';
          if (eff >= 80) effClass = 'high';
          else if (eff >= 60) effClass = 'medium';
          else if (eff > 0) effClass = 'low';
          
          const rewardHtml = emp.reward && emp.reward.description !== '√ñd√ºl yok'
            ? `<span class="reward-badge ${emp.reward.type}">${getRewardIcon(emp.reward.type)} ${emp.reward.description}</span>`
            : '<span style="color: var(--text-muted);">‚Äî</span>';
          
          return `
            <tr>
              <td><strong>${emp.fullName}</strong></td>
              <td><span class="efficiency-badge ${effClass}">${emp.efficiency}%</span></td>
              <td>${rewardHtml}</td>
            </tr>
          `;
        }).join('');
        
      } catch (error) {
        console.error('[Rewards] Error loading employee rewards:', error);
        tbody.innerHTML = '<tr><td colspan="3" style="color: var(--danger);">Veriler y√ºklenemedi.</td></tr>';
      }
    }

    function getRewardIcon(type) {
      const icons = { cash: 'üíµ', giftCard: 'üéÅ', other: 'üì¶' };
      return icons[type] || 'üèÜ';
    }

    // Open rule modal for new rule
    function openRuleModal() {
      editingRuleId = null;
      document.getElementById('ruleModalTitle').textContent = 'Yeni √ñd√ºl Kuralƒ±';
      document.getElementById('ruleForm').reset();
      document.getElementById('ruleModal').classList.add('active');
    }

    // Close rule modal
    function closeRuleModal() {
      document.getElementById('ruleModal').classList.remove('active');
      editingRuleId = null;
    }

    // Edit existing rule
    function editRule(id) {
      const rule = currentRules.find(r => r.id === id);
      if (!rule) return;
      
      editingRuleId = id;
      document.getElementById('ruleModalTitle').textContent = 'Kuralƒ± D√ºzenle';
      document.getElementById('ruleId').value = id;
      document.getElementById('ruleMin').value = rule.minPercentage;
      document.getElementById('ruleMax').value = rule.maxPercentage || '';
      document.getElementById('ruleType').value = rule.rewardType;
      document.getElementById('ruleAmount').value = rule.amount || '';
      document.getElementById('ruleDescription').value = rule.description;
      document.getElementById('ruleModal').classList.add('active');
    }

    // Delete rule
    async function deleteRule(id) {
      if (!confirm('Bu kuralƒ± silmek istediƒüinize emin misiniz?')) return;
      
      try {
        const response = await fetch(`/api/rewards/rules/${id}`, { method: 'DELETE' });
        if (response.ok) {
          loadRewardRules();
          loadEmployeeRewards();
        } else {
          alert('Kural silinemedi.');
        }
      } catch (error) {
        console.error('[Rewards] Delete error:', error);
        alert('Bir hata olu≈ütu.');
      }
    }

    // Handle rule form submission
    document.getElementById('ruleForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
        minPercentage: parseFloat(document.getElementById('ruleMin').value),
        maxPercentage: document.getElementById('ruleMax').value ? parseFloat(document.getElementById('ruleMax').value) : null,
        rewardType: document.getElementById('ruleType').value,
        amount: document.getElementById('ruleAmount').value ? parseFloat(document.getElementById('ruleAmount').value) : null,
        description: document.getElementById('ruleDescription').value
      };
      
      try {
        let response;
        if (editingRuleId) {
          response = await fetch(`/api/rewards/rules/${editingRuleId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        } else {
          response = await fetch('/api/rewards/rules', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        }
        
        if (response.ok) {
          closeRuleModal();
          // Refresh rules list
          loadRewardRules();
          // Small delay to ensure backend has processed the new rule, then refresh employee rewards
          setTimeout(() => {
            loadEmployeeRewards();
          }, 100);
        } else {
          alert('Kayƒ±t ba≈üarƒ±sƒ±z.');
        }
      } catch (error) {
        console.error('[Rewards] Save error:', error);
        alert('Bir hata olu≈ütu.');
      }
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      console.log('[App] DOM loaded, initializing...');
      setTimeout(() => {
        loadPerformanceChart();
        loadEvaluations();
      }, 100);
    });
  </script>
</body>
</html>
